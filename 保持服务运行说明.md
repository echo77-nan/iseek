# 保持服务持续运行的方案

## 问题
前端/后端服务在终端断开后会停止运行。

## 解决方案

### 方案1：使用后台启动脚本（推荐）

#### 启动服务

```bash
# 启动后端（后台模式）
cd /home/echo.ln/iseek/backend
bash start-daemon.sh

# 启动前端（后台模式）
cd /home/echo.ln/iseek/frontend
bash start-daemon.sh

# 或一键启动所有服务
cd /home/echo.ln/iseek
bash start-all.sh
```

#### 停止服务

```bash
# 停止后端
cd /home/echo.ln/iseek/backend
bash stop.sh

# 停止前端
cd /home/echo.ln/iseek/frontend
bash stop.sh

# 或一键停止所有服务
cd /home/echo.ln/iseek
bash stop-all.sh
```

#### 查看日志

```bash
# 后端日志
tail -f /home/echo.ln/iseek/backend/logs/backend.log

# 前端日志
tail -f /home/echo.ln/iseek/frontend/logs/frontend.log
```

### 方案2：使用 screen（适合临时会话）

```bash
# 安装 screen（如果没有）
# yum install screen  # CentOS/RHEL
# apt-get install screen  # Ubuntu/Debian

# 创建 screen 会话
screen -S iseek-frontend
cd /home/echo.ln/iseek/frontend
npm start
# 按 Ctrl+A 然后按 D 退出（服务继续运行）

# 重新连接
screen -r iseek-frontend

# 查看所有会话
screen -ls
```

### 方案3：使用 tmux（推荐用于服务器）

```bash
# 安装 tmux（如果没有）
# yum install tmux  # CentOS/RHEL
# apt-get install tmux  # Ubuntu/Debian

# 创建 tmux 会话
tmux new -s iseek-frontend
cd /home/echo.ln/iseek/frontend
npm start
# 按 Ctrl+B 然后按 D 退出（服务继续运行）

# 重新连接
tmux attach -t iseek-frontend

# 查看所有会话
tmux ls
```

### 方案4：使用 PM2（Node.js 进程管理器，推荐用于生产环境）

```bash
# 安装 PM2
npm install -g pm2

# 启动前端
cd /home/echo.ln/iseek/frontend
pm2 start npm --name "iseek-frontend" -- start

# 启动后端（需要创建启动脚本）
cd /home/echo.ln/iseek/backend
pm2 start "uvicorn app.main:app --host 0.0.0.0 --port 8000" --name "iseek-backend"

# 查看状态
pm2 status

# 查看日志
pm2 logs

# 停止服务
pm2 stop iseek-frontend
pm2 stop iseek-backend

# 重启服务
pm2 restart iseek-frontend

# 设置开机自启
pm2 startup
pm2 save
```

### 方案5：使用 systemd（Linux 系统服务，推荐用于生产环境）

创建 systemd 服务文件：

```bash
# 创建前端服务
sudo nano /etc/systemd/system/iseek-frontend.service
```

内容：
```ini
[Unit]
Description=iSeek Frontend Service
After=network.target

[Service]
Type=simple
User=echo.ln
WorkingDirectory=/home/echo.ln/iseek/frontend
ExecStart=/usr/bin/npm start
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

```bash
# 创建后端服务
sudo nano /etc/systemd/system/iseek-backend.service
```

内容：
```ini
[Unit]
Description=iSeek Backend Service
After=network.target

[Service]
Type=simple
User=echo.ln
WorkingDirectory=/home/echo.ln/iseek/backend
ExecStart=/home/echo.ln/iseek/backend/venv/bin/uvicorn app.main:app --host 0.0.0.0 --port 8000
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

启动服务：
```bash
# 重新加载 systemd
sudo systemctl daemon-reload

# 启动服务
sudo systemctl start iseek-frontend
sudo systemctl start iseek-backend

# 设置开机自启
sudo systemctl enable iseek-frontend
sudo systemctl enable iseek-backend

# 查看状态
sudo systemctl status iseek-frontend
sudo systemctl status iseek-backend

# 查看日志
sudo journalctl -u iseek-frontend -f
sudo journalctl -u iseek-backend -f
```

## 推荐方案

- **开发环境**：使用 `start-daemon.sh` 脚本（方案1）
- **测试环境**：使用 screen 或 tmux（方案2/3）
- **生产环境**：使用 PM2 或 systemd（方案4/5）

## 注意事项

1. 使用后台脚本时，日志会保存在 `logs/` 目录
2. PID 文件保存在 `logs/*.pid`，用于停止服务
3. 确保日志目录有写入权限
4. 定期清理日志文件，避免占用过多磁盘空间

